<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatsMaster Pro - UE27</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct-btn { background-color: #10b981 !important; border-color: #059669 !important; color: white; }
        .wrong-btn { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .hidden { display: none; }
        .card-hover:hover { transform: translateY(-5px); transition: 0.3s; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <nav class="bg-indigo-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">üìä UE27 : Stats & √âpido</h1>
            <div class="flex gap-4">
                <button onclick="showSection('home')" class="hover:text-indigo-200">Accueil</button>
                <button onclick="showSection('stats')" class="hover:text-indigo-200">Ma Progression</button>
            </div>
        </div>
    </nav>

    <section id="home" class="container mx-auto p-6">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Modules d'Entra√Ænement</h2>
        <div class="grid md:grid-cols-3 gap-6" id="module-grid"></div>
    </section>

    <section id="stats-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl text-center">
            <h2 class="text-3xl font-bold mb-4">Tableau de Bord</h2>
            <div id="global-score" class="text-6xl font-black text-indigo-600 mb-8">0%</div>
            <div id="module-stats" class="space-y-4 text-left"></div>
            
            <button onclick="resetScores()" class="mt-12 bg-red-50 text-red-600 px-6 py-2 rounded-full text-sm font-bold hover:bg-red-100 transition border border-red-200">
                Effacer mes scores et recommencer
            </button>
        </div>
    </section>

    <section id="quiz-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <span id="quiz-title" class="text-indigo-600 font-bold uppercase text-xs tracking-widest"></span>
                <span id="progress-text" class="text-gray-400 text-sm"></span>
            </div>
            
            <div id="quiz-content">
                <h2 id="question-text" class="text-xl font-semibold text-gray-800 mb-6"></h2>
                <div id="options-container" class="space-y-3"></div>
                <div id="explanation-box" class="mt-6 p-4 rounded-xl bg-amber-50 border border-amber-200 hidden">
                    <p class="text-sm text-amber-800"><strong id="feedback-status"></strong> <span id="explanation-text"></span></p>
                </div>
                <button id="next-btn" class="w-full mt-8 bg-indigo-600 text-white py-4 rounded-xl font-bold hidden shadow-lg">Continuer</button>
            </div>

            <div id="review-content" class="hidden text-center">
                <h3 class="text-2xl font-bold mb-4 text-slate-800">Analyse de tes erreurs üßê</h3>
                <div id="errors-list" class="space-y-4 mb-8 text-left"></div>
                <button onclick="showSection('home')" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold">Retour √† l'accueil</button>
            </div>
        </div>
    </section>

    <script>
        const db = {
            c1: { title: "Introduction Statistique", questions: [
                { q: "Quelle est la d√©finition de la statistique ?", o: ["La science du recueil et de l'analyse", "L'ensemble des chiffres d'une √©tude", "Une probabilit√©"], a: 0, e: "La statistique est la science, tandis que LES statistiques sont les r√©sultats chiffr√©s." },
                { q: "Une variable 'Taille en cm' est :", o: ["Qualitative", "Quantitative discr√®te", "Quantitative continue"], a: 2, e: "Une mesure physique comme la taille peut prendre une infinit√© de valeurs, elle est continue." },
                { q: "Si p = 0.04, que d√©cide-t-on au seuil de 5% ?", o: ["On conserve H0", "On rejette H0", "On ne peut pas conclure"], a: 1, e: "p < 0.05 signifie que le r√©sultat est statistiquement significatif, on rejette l'hypoth√®se nulle." },
                { q: "La m√©diane est l'indicateur qui :", o: ["Est le plus fr√©quent", "Partage la s√©rie en deux moiti√©s √©gales", "Est la moyenne arithm√©tique"], a: 1, e: "La m√©diane divise la population en 50% au-dessus et 50% en-dessous." },
                { q: "Le test de corr√©lation de Pearson √©tudie :", o: ["Le lien entre 2 variables quantitatives", "La diff√©rence entre 2 moyennes", "La concordance"], a: 0, e: "Le coefficient 'r' mesure la force du lien lin√©aire entre deux variables num√©riques." },
                { q: "H0 signifie g√©n√©ralement :", o: ["Il existe une diff√©rence", "Il n'existe pas de diff√©rence", "Le test est biais√©"], a: 1, e: "H0 est l'hypoth√®se de base : tout ce qu'on observe est d√ª au hasard." },
                { q: "L'√©cart-type mesure :", o: ["La position", "La dispersion", "La tendance centrale"], a: 1, e: "Il indique comment les donn√©es sont √©tal√©es autour de la moyenne." },
                { q: "Une √©tude sur TOUTE la population s'appelle :", o: ["Un sondage", "Un √©chantillonnage", "Un recensement"], a: 2, e: "Le recensement √©tudie l'exhaustivit√© de la population." },
                { q: "Le risque Alpha (5%) est le risque de :", o: ["Rejeter H0 √† tort", "Conserver H0 √† tort"], a: 0, e: "C'est conclure √† une diff√©rence qui n'existe pas en r√©alit√©." },
                { q: "Une variable ordinale est une variable :", o: ["Quantitative", "Qualitative avec un ordre", "Binaire"], a: 1, e: "Exemple : Stade de la maladie (I, II, III). C'est ordonn√©." },
                { q: "La variance est :", o: ["La racine carr√©e de l'√©cart-type", "Le carr√© de l'√©cart-type"], a: 1, e: "Math√©matiquement, s¬≤ = variance." },
                { q: "Le mode est :", o: ["La valeur la plus fr√©quente", "La valeur centrale", "La valeur la plus haute"], a: 0, e: "Le mode est la valeur associ√©e au plus grand effectif." },
                { q: "L'inf√©rence statistique permet de :", o: ["D√©crire l'√©chantillon", "G√©n√©raliser √† la population", "Calculer la moyenne"], a: 1, e: "C'est passer de l'observation √† la loi g√©n√©rale." },
                { q: "Si r = -0.9, la corr√©lation est :", o: ["Nulle", "Forte et inverse", "Faible"], a: 1, e: "Proche de -1 ou 1 signifie une corr√©lation forte." },
                { q: "Un √©chantillon doit √™tre :", o: ["Le plus petit possible", "Repr√©sentatif", "Compos√© de volontaires"], a: 1, e: "La repr√©sentativit√© est cruciale pour l'inf√©rence." }
            ]},
            c2: { title: "Tests Diagnostiques", questions: [
                { q: "Probabilit√© d'√™tre T+ quand on est Malade :", o: ["VPP", "Sensibilit√©", "Sp√©cificit√©"], a: 1, e: "Se = VP / (VP + FN). C'est d√©tecter les vrais malades." },
                { q: "La Sp√©cificit√© est la probabilit√© :", o: ["D'√™tre T- chez les non-malades", "D'√™tre non-malade chez les T-"], a: 0, e: "Sp = VN / (VN + FP). C'est identifier les sujets sains." },
                { q: "La VPP d√©pend de la pr√©valence :", o: ["Vrai", "Faux"], a: 0, e: "Plus la maladie est rare, plus la VPP chute." },
                { q: "Le coefficient Kappa √©value :", o: ["La force d'un risque", "La concordance", "La moyenne"], a: 1, e: "Il compare l'accord observ√© √† l'accord d√ª au hasard." },
                { q: "Un Kappa de 0.85 est :", o: ["Moyen", "Excellent", "N√©gligeable"], a: 1, e: "Au-dessus de 0.80, c'est jug√© excellent." },
                { q: "La courbe ROC √©tudie :", o: ["Le lien Se / (1-Sp)", "Le lien VPP / VPN"], a: 0, e: "Elle permet de choisir le meilleur seuil d√©cisionnel." },
                { q: "L'aire sous la courbe (AUC) id√©ale est :", o: ["0.5", "1", "0"], a: 1, e: "Une AUC de 1 signifie que le test est parfait." },
                { q: "Le Gold Standard est :", o: ["Le nouveau test", "La r√©f√©rence de v√©rit√©", "Un test de d√©pistage"], a: 1, e: "C'est l'examen de certitude (ex: biopsie)." },
                { q: "Si on augmente le seuil de d√©tection, la sensibilit√© :", o: ["Augmente", "Diminue"], a: 1, e: "En √©tant plus strict, on rate plus de malades, donc Se baisse." },
                { q: "La VPN est la probabilit√© d'√™tre sain si :", o: ["Le test est n√©gatif", "Le test est positif"], a: 0, e: "VPN = Probabilit√©(M- | T-)." },
                { q: "Un test avec une Se de 100% n'a aucun :", o: ["Faux positif", "Faux n√©gatif"], a: 1, e: "Il d√©tecte TOUS les malades sans exception." },
                { q: "Le Kappa de 0 signifie :", o: ["Accord parfait", "Accord d√ª au hasard", "D√©saccord total"], a: 1, e: "Z√©ro indique un accord uniquement li√© au hasard." },
                { q: "La pr√©valence est :", o: ["Le nombre de nouveaux cas", "La proportion de malades √† un instant T"], a: 1, e: "C'est un indicateur statique de fr√©quence." },
                { q: "Pour un d√©pistage, on privil√©gie :", o: ["La sensibilit√©", "La sp√©cificit√©"], a: 0, e: "On veut ne rater aucun cas (haute Se)." },
                { q: "La validit√© intrins√®que regroupe :", o: ["Se et Sp", "VPP et VPN"], a: 0, e: "Elles ne d√©pendent pas de la pr√©valence." }
            ]},
            c3: { title: "√âpid√©miologie", questions: [
                { q: "L'incidence mesure :", o: ["Les anciens cas", "Les nouveaux cas par unit√© de temps"], a: 1, e: "C'est une notion de flux (dynamique)." },
                { q: "Le Risque Relatif (RR) se calcule dans :", o: ["√âtude Cas-T√©moins", "√âtude de Cohorte"], a: 1, e: "Il faut suivre les gens dans le temps." },
                { q: "L'Odds Ratio (OR) est utilis√© quand :", o: ["On part de la maladie (Cas-T√©moins)", "On part de l'exposition"], a: 0, e: "C'est l'indicateur pour les maladies rares." },
                { q: "RR = 1 signifie :", o: ["Risque doubl√©", "Pas d'association", "Facteur protecteur"], a: 1, e: "Pas de diff√©rence entre expos√©s et non-expos√©s." },
                { q: "Si IC 95% du RR est [1.2 ; 3.4] :", o: ["C'est significatif", "Ce n'est pas significatif"], a: 0, e: "L'intervalle ne contient pas 1." },
                { q: "L'√©tude transversale √©tudie :", o: ["L'incidence", "La pr√©valence"], a: 1, e: "C'est une photo √† un instant T." },
                { q: "Un facteur de risque a un RR :", o: ["> 1", "< 1"], a: 0, e: "L'exposition augmente la probabilit√© de maladie." },
                { q: "Le biais de confusion se limite par :", o: ["L'augmentation de l'√©chantillon", "La randomisation"], a: 1, e: "R√©partir au hasard √©quilibre les facteurs." },
                { q: "L'√©pid√©miologie √©tiologique cherche √† :", o: ["D√©crire", "Chercher les causes"], a: 1, e: "Elle cherche les liens de causalit√©." },
                { q: "Une √©tude de cohorte est :", o: ["R√©trospective", "Prospective"], a: 1, e: "On suit les sujets vers le futur." },
                { q: "Un OR = 0.5 signifie :", o: ["Risque multipli√© par 2", "Effet protecteur"], a: 1, e: "< 1 indique une protection." },
                { q: "L'√©tude Cas-T√©moins est :", o: ["Rapide et moins ch√®re", "Longue et ch√®re"], a: 0, e: "Adapt√©e aux maladies √† longue latence." },
                { q: "Le taux de mortalit√© est :", o: ["Morts / Population totale", "Morts / Nombre de malades"], a: 0, e: "√Ä ne pas confondre avec la l√©talit√©." },
                { q: "La randomisation est propre √† :", o: ["L'√©tude observationnelle", "L'essai clinique"], a: 1, e: "C'est l'exp√©rimentateur qui r√©partit l'exposition." },
                { q: "Q18 Balay√© : La p-valeur est :", o: ["La probabilit√© d'erreur", "La probabilit√© d'observer les donn√©es sous H0"], a: 1, e: "Force de la preuve contre l'hypoth√®se nulle." }
            ]}
        };

        let currentModule = '';
        let currentIdx = 0;
        let score = 0;
        let userErrors = [];
        
        // CHARGEMENT INITIAL DES SCORES
        let scoresSaved = JSON.parse(localStorage.getItem('stats_v3')) || { c1: 0, c2: 0, c3: 0 };

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id + (id.includes('section') ? '' : '')).classList.remove('hidden');
            if(id === 'home') renderModules();
            if(id === 'stats') renderStats();
        }

        function renderModules() {
            const grid = document.getElementById('module-grid');
            grid.innerHTML = '';
            Object.keys(db).forEach(key => {
                const s = scoresSaved[key] || 0;
                grid.innerHTML += `
                    <div onclick="startQuiz('${key}')" class="bg-white p-6 rounded-3xl shadow-md border-b-8 ${s > 70 ? 'border-green-400' : 'border-indigo-400'} cursor-pointer card-hover">
                        <h3 class="font-bold text-xl mb-1">${db[key].title}</h3>
                        <p class="text-gray-500 text-sm mb-4">15 Questions</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-black px-2 py-1 rounded bg-slate-100">${s}% r√©ussi</span>
                            <span class="text-indigo-600 font-bold">Lancer ‚Üí</span>
                        </div>
                    </div>`;
            });
        }

        function startQuiz(key) {
            currentModule = key;
            currentIdx = 0;
            score = 0;
            userErrors = [];
            showSection('quiz-section');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('review-content').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = db[currentModule].questions[currentIdx];
            document.getElementById('quiz-title').innerText = db[currentModule].title;
            document.getElementById('progress-text').innerText = `${currentIdx + 1} / 15`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:bg-slate-50 font-medium transition";
                b.innerText = opt;
                b.onclick = () => check(i, b);
                container.appendChild(b);
            });
        }

        function check(idx, btn) {
            const q = db[currentModule].questions[currentIdx];
            const btns = document.getElementById('options-container').children;
            const isCorrect = (idx === q.a);
            
            if(isCorrect) {
                score++;
                btn.classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Bravo !";
                document.getElementById('feedback-status').className = "text-green-600 font-bold";
            } else {
                btn.classList.add('wrong-btn');
                btns[q.a].classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Erreur...";
                document.getElementById('feedback-status').className = "text-red-600 font-bold";
                userErrors.push({ q: q.q, correct: q.o[q.a], expl: q.e });
            }

            document.getElementById('explanation-text').innerText = q.e;
            document.getElementById('explanation-box').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            for(let b of btns) b.disabled = true;
        }

        document.getElementById('next-btn').onclick = () => {
            currentIdx++;
            if(currentIdx < 15) loadQuestion(); else finish();
        };

        function finish() {
            const p = Math.round((score / 15) * 100);
            if(p > (scoresSaved[currentModule] || 0)) {
                scoresSaved[currentModule] = p;
                localStorage.setItem('stats_v3', JSON.stringify(scoresSaved));
            }
            
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('review-content').classList.remove('hidden');
            
            const errList = document.getElementById('errors-list');
            errList.innerHTML = userErrors.length === 0 ? "<p class='text-green-600 font-bold'>Z√©ro faute ! Tu ma√Ætrises parfaitement ce chapitre.</p>" : "";
            
            userErrors.forEach(err => {
                errList.innerHTML += `
                    <div class="p-4 bg-red-50 rounded-xl border-l-4 border-red-400">
                        <p class="font-bold text-gray-800 text-sm">${err.q}</p>
                        <p class="text-xs text-green-700 font-bold mt-1">‚úì R√©ponse correcte : ${err.correct}</p>
                        <p class="text-xs text-gray-600 italic mt-1">${err.expl}</p>
                    </div>`;
            });
        }

        function renderStats() {
            const s1 = scoresSaved.c1 || 0;
            const s2 = scoresSaved.c2 || 0;
            const s3 = scoresSaved.c3 || 0;
            const avg = Math.round((s1 + s2 + s3) / 3);
            
            document.getElementById('global-score').innerText = avg + "%";
            const cont = document.getElementById('module-stats');
            cont.innerHTML = '';
            Object.keys(db).forEach(k => {
                const val = scoresSaved[k] || 0;
                cont.innerHTML += `
                    <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                        <span class="text-sm font-medium">${db[k].title}</span>
                        <span class="font-bold text-indigo-600">${val}%</span>
                    </div>`;
            });
        }

        // FONCTION DE R√âINITIALISATION
        function resetScores() {
            if (confirm("Es-tu s√ªr de vouloir effacer tous tes scores ?")) {
                localStorage.removeItem('stats_v3');
                scoresSaved = { c1: 0, c2: 0, c3: 0 };
                renderStats();
                renderModules();
                alert("Scores r√©initialis√©s.");
            }
        }

        // LANCEMENT
        showSection('home');
    </script>
</body>
</html>
