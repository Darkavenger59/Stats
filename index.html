<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatsMaster Pro - UE27</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct-btn { background-color: #10b981 !important; border-color: #059669 !important; color: white; }
        .wrong-btn { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .hidden { display: none; }
        .card-hover:hover { transform: translateY(-5px); transition: 0.3s; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <nav class="bg-indigo-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">üìä UE27 : Stats & √âpido</h1>
            <div class="flex gap-4">
                <button onclick="showSection('home')" class="hover:text-indigo-200">Accueil</button>
                <button onclick="showSection('stats')" class="hover:text-indigo-200">Ma Progression</button>
            </div>
        </div>
    </nav>

    <section id="home" class="container mx-auto p-6">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Modules d'Entra√Ænement</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="module-grid"></div>
    </section>

    <section id="stats-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl text-center">
            <h2 class="text-3xl font-bold mb-4">Tableau de Bord</h2>
            <div id="global-score" class="text-6xl font-black text-indigo-600 mb-8">0%</div>
            <div id="module-stats" class="space-y-4 text-left"></div>
            
            <button onclick="resetScores()" class="mt-12 bg-red-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-red-700 transition">
                R√âINITIALISER TOUS LES SCORES
            </button>
        </div>
    </section>

    <section id="quiz-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <span id="quiz-title" class="text-indigo-600 font-bold uppercase text-xs tracking-widest"></span>
                <span id="progress-text" class="text-gray-400 text-sm"></span>
            </div>
            
            <div id="quiz-content">
                <h2 id="question-text" class="text-xl font-semibold text-gray-800 mb-6"></h2>
                <div id="options-container" class="space-y-3"></div>
                <div id="explanation-box" class="mt-6 p-4 rounded-xl bg-amber-50 border border-amber-200 hidden">
                    <p class="text-sm text-amber-800"><strong id="feedback-status"></strong> <span id="explanation-text"></span></p>
                </div>
                <button id="next-btn" class="w-full mt-8 bg-indigo-600 text-white py-4 rounded-xl font-bold hidden shadow-lg">Continuer</button>
            </div>

            <div id="review-content" class="hidden">
                <h3 class="text-2xl font-bold mb-4 text-center">Analyse de tes erreurs üßê</h3>
                <div id="errors-list" class="space-y-4 mb-8"></div>
                <button onclick="showSection('home')" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold">Retour √† l'accueil</button>
            </div>
        </div>
    </section>

    <script>
        const db = {
            // --- BLOC 1 : INTRODUCTION STATISTIQUE ---
            c1: { title: "Introduction Statistique (Basique)", questions: [
                { q: "Quelle est la d√©finition de la statistique ?", o: ["La science du recueil et de l'analyse", "L'ensemble des chiffres d'une √©tude", "Une probabilit√©"], a: 0, e: "La statistique est la science, tandis que LES statistiques sont les r√©sultats chiffr√©s." },
                { q: "Une variable 'Taille en cm' est :", o: ["Qualitative", "Quantitative discr√®te", "Quantitative continue"], a: 2, e: "Une mesure physique comme la taille peut prendre une infinit√© de valeurs, elle est continue." },
                { q: "Si p = 0.04, que d√©cide-t-on au seuil de 5% ?", o: ["On conserve H0", "On rejette H0", "On ne peut pas conclure"], a: 1, e: "p < 0.05 signifie que le r√©sultat est statistiquement significatif, on rejette l'hypoth√®se nulle." },
                { q: "La m√©diane est l'indicateur qui :", o: ["Est le plus fr√©quent", "Partage la s√©rie en deux moiti√©s √©gales", "Est la moyenne arithm√©tique"], a: 1, e: "La m√©diane divise la population en 50% au-dessus et 50% en-dessous." },
                { q: "Le test de corr√©lation de Pearson √©tudie :", o: ["Le lien entre 2 variables quantitatives", "La diff√©rence entre 2 moyennes", "La concordance"], a: 0, e: "Le coefficient 'r' mesure la force du lien lin√©aire entre deux variables num√©riques." },
                { q: "H0 signifie g√©n√©ralement :", o: ["Il existe une diff√©rence", "Il n'existe pas de diff√©rence", "Le test est biais√©"], a: 1, e: "H0 est l'hypoth√®se de base : tout ce qu'on observe est d√ª au hasard." },
                { q: "L'√©cart-type mesure :", o: ["La position", "La dispersion", "La tendance centrale"], a: 1, e: "Il indique comment les donn√©es sont √©tal√©es autour de la moyenne." },
                { q: "Une √©tude sur TOUTE la population s'appelle :", o: ["Un sondage", "Un √©chantillonnage", "Un recensement"], a: 2, e: "Le recensement √©tudie l'exhaustivit√© de la population." },
                { q: "Le risque Alpha (5%) est le risque de :", o: ["Rejeter H0 √† tort", "Conserver H0 √† tort"], a: 0, e: "C'est conclure √† une diff√©rence qui n'existe pas en r√©alit√©." },
                { q: "Une variable ordinale est une variable :", o: ["Quantitative", "Qualitative avec un ordre", "Binaire"], a: 1, e: "Exemple : Stade de la maladie (I, II, III). C'est ordonn√©." }
            ]},
            // --- BLOC 2 : TESTS DIAGNOSTIQUES ---
            c2: { title: "Tests Diagnostiques (Basique)", questions: [
                { q: "Probabilit√© d'√™tre T+ quand on est Malade :", o: ["VPP", "Sensibilit√©", "Sp√©cificit√©"], a: 1, e: "Se = VP / (VP + FN). C'est d√©tecter les malades." },
                { q: "La Sp√©cificit√© est la probabilit√© :", o: ["D'√™tre T- chez les non-malades", "D'√™tre non-malade chez les T-"], a: 0, e: "Sp = VN / (VN + FP). C'est identifier les sujets sains." },
                { q: "La VPP d√©pend de la pr√©valence :", o: ["Vrai", "Faux"], a: 0, e: "Plus la maladie est rare, plus la VPP chute." },
                { q: "Le coefficient Kappa √©value :", o: ["La force d'un risque", "La concordance", "La moyenne"], a: 1, e: "Il compare l'accord observ√© √† l'accord d√ª au hasard." },
                { q: "Un Kappa de 0.85 est :", o: ["Moyen", "Excellent", "N√©gligeable"], a: 1, e: "Au-dessus de 0.80, la concordance est jug√©e excellente." },
                { q: "La courbe ROC √©tudie :", o: ["Le lien Se / (1-Sp)", "Le lien VPP / VPN"], a: 0, e: "Elle permet de choisir le meilleur seuil d√©cisionnel." },
                { q: "L'aire sous la courbe (AUC) d'un test parfait est :", o: ["0.5", "1", "0"], a: 1, e: "Une AUC de 1 signifie que le test ne se trompe jamais." },
                { q: "Le Gold Standard est :", o: ["Le nouveau test", "La r√©f√©rence de v√©rit√©", "Un test de d√©pistage"], a: 1, e: "C'est l'examen de certitude (ex: biopsie)." },
                { q: "Si on augmente le seuil de d√©tection, la sensibilit√© :", o: ["Augmente", "Diminue"], a: 1, e: "En √©tant plus strict, on rate plus de malades, donc Se baisse." },
                { q: "La VPN est la probabilit√© d'√™tre sain si :", o: ["Le test est n√©gatif", "Le test est positif"], a: 0, e: "VPN = Probabilit√©(M- | T-)." }
            ]},
            // --- BLOC 3 : √âPID√âMIOLOGIE ---
            c3: { title: "√âpid√©miologie (Basique)", questions: [
                { q: "L'incidence mesure :", o: ["Les anciens cas", "Les nouveaux cas par unit√© de temps"], a: 1, e: "C'est une notion de flux (dynamique)." },
                { q: "Le Risque Relatif (RR) se calcule dans :", o: ["√âtude Cas-T√©moins", "√âtude de Cohorte"], a: 1, e: "Il faut suivre les gens dans le temps." },
                { q: "L'Odds Ratio (OR) est utilis√© quand :", o: ["On part de la maladie (Cas-T√©moins)", "On part de l'exposition"], a: 0, e: "C'est l'indicateur pour les maladies rares." },
                { q: "RR = 1 signifie :", o: ["Risque doubl√©", "Pas d'association", "Facteur protecteur"], a: 1, e: "Le risque chez les expos√©s est le m√™me." },
                { q: "Si IC 95% du RR est [1.2 ; 3.4] :", o: ["C'est significatif", "Ce n'est pas significatif"], a: 0, e: "L'intervalle ne contient pas 1, donc le risque est r√©el." },
                { q: "L'√©tude transversale √©tudie :", o: ["L'incidence", "La pr√©valence"], a: 1, e: "C'est une 'photographie' √† un moment donn√©." },
                { q: "Un facteur de risque a un RR :", o: ["> 1", "< 1"], a: 0, e: "L'exposition augmente la probabilit√© de maladie." },
                { q: "Le biais de confusion se limite par :", o: ["L'augmentation de l'√©chantillon", "La randomisation"], a: 1, e: "R√©partir au hasard √©quilibre les facteurs." },
                { q: "L'√©pid√©miologie √©tiologique sert √† :", o: ["Compter les cas", "Chercher les causes"], a: 1, e: "Elle cherche les liens de causalit√©." },
                { q: "Une √©tude de cohorte est :", o: ["R√©trospective", "Prospective"], a: 1, e: "On suit les sujets du pr√©sent vers le futur." }
            ]},
            // --- NOUVEAU BLOC 4 : APPROFONDISSEMENT STATS ---
            c4: { title: "Stats : Formatage & Recueil", questions: [
                { q: "Dans un fichier de donn√©es propre (Excel), chaque ligne doit √™tre :", o: ["Une variable", "Un individu statistique", "Une moyenne"], a: 1, e: "C'est la r√®gle d'or : une ligne = un patient/sujet." },
                { q: "Pour une analyse stat, quel format de fichier est proscrit ?", o: ["XLSX", "PDF", "CSV"], a: 1, e: "Le PDF ne permet pas le traitement automatique des donn√©es." },
                { q: "Une variable 'Sexe' (H/F) est :", o: ["Qualitative nominale binaire", "Qualitative ordinale", "Quantitative"], a: 0, e: "Deux cat√©gories sans ordre particulier." },
                { q: "L'onglet 'Variables' (Codebook) sert √† :", o: ["Stocker les noms des patients", "D√©finir le type et le sens des colonnes", "Faire les graphiques"], a: 1, e: "Il sert de dictionnaire pour l'analyste." },
                { q: "Comment traite-t-on les cellules fusionn√©es en statistique ?", o: ["On les adore", "On les interdit strictement", "C'est optionnel"], a: 1, e: "Les cellules fusionn√©es emp√™chent l'analyse par les logiciels." },
                { q: "La statistique descriptive univari√©e √©tudie :", o: ["Le lien entre 2 variables", "Une seule variable √† la fois", "L'extrapolation"], a: 1, e: "Ex: Moyenne d'√¢ge ou % d'hommes." },
                { q: "Quelle repr√©sentation pour une variable qualitative ?", o: ["Histogramme", "Diagramme circulaire", "Nuage de points"], a: 1, e: "Le 'camembert' ou les barres sont adapt√©s aux cat√©gories." },
                { q: "Le mode d'une classe (ex: [20-30]) est :", o: ["Le milieu de la classe (25)", "La borne haute (30)", "La borne basse (20)"], a: 0, e: "On prend le centre de l'intervalle par convention." },
                { q: "L'√©chantillonnage al√©atoire simple permet :", o: ["De choisir ses amis", "Une repr√©sentativit√© th√©orique", "De gagner du temps"], a: 1, e: "Le hasard pur √©vite les biais de s√©lection." },
                { q: "Un plan d'analyse statistique se r√©dige :", o: ["Avant le recueil des donn√©es", "Apr√®s l'analyse", "Pendant la publication"], a: 0, e: "On d√©cide de ce qu'on va tester AVANT de regarder les r√©sultats." }
            ]},
            // --- NOUVEAU BLOC 5 : APPROFONDISSEMENT DIAGNOSTIC ---
            c5: { title: "Diagnostic : Courbe ROC & Kappa", questions: [
                { q: "Sur une courbe ROC, plus l'aire (AUC) est proche de 1 :", o: ["Plus le test est mauvais", "Plus le test est performant", "Plus le test est cher"], a: 1, e: "1 = Discrimination parfaite." },
                { q: "La diagonale sur une courbe ROC repr√©sente :", o: ["Un test parfait", "Le hasard pur (AUC = 0.5)", "La p-valeur"], a: 1, e: "C'est le niveau d'un test inutile." },
                { q: "Pour augmenter la Sensibilit√© d'un test continu, il faut :", o: ["Baisser le seuil", "Monter le seuil", "Ne rien changer"], a: 0, e: "En baissant le seuil, on 'ratisse' plus large et on rate moins de malades." },
                { q: "Le Kappa de Cohen retire de l'accord observ√© :", o: ["Les erreurs", "L'accord d√ª au hasard", "Les cas rares"], a: 1, e: "C'est ce qui le rend plus robuste qu'un simple % d'accord." },
                { q: "Un Kappa de 0.30 est consid√©r√© comme :", o: ["Excellent", "Faible", "N√©gatif"], a: 1, e: "Entre 0.2 et 0.4, la concordance est faible." },
                { q: "La reproductibilit√© est √©valu√©e par :", o: ["La sensibilit√©", "La concordance", "La pr√©valence"], a: 1, e: "C'est la capacit√© √† donner le m√™me r√©sultat plusieurs fois." },
                { q: "Le Gold Standard est toujours :", o: ["Le test le moins cher", "La r√©f√©rence de v√©rit√©", "Le test le plus rapide"], a: 1, e: "Ex: La biopsie pour un cancer." },
                { q: "Si on veut rater ZERO malades (d√©pistage), on veut :", o: ["Se = 100%", "Sp = 100%", "VPP = 100%"], a: 0, e: "La sensibilit√© est la priorit√© du d√©pistage." },
                { q: "La valeur pr√©dictive n√©gative (VPN) augmente si :", o: ["La maladie est rare", "La maladie est fr√©quente"], a: 0, e: "Moins il y a de malades, plus il est facile d'√™tre s√ªr qu'un test n√©gatif est vrai." },
                { q: "Un test avec AUC = 0.8 est qualifi√© de :", o: ["M√©diocre", "Bon", "Parfait"], a: 1, e: "C'est un test tout √† fait honorable en clinique." }
            ]},
            // --- NOUVEAU BLOC 6 : APPROFONDISSEMENT √âPID√âMIO ---
            c6: { title: "√âpid√©mio : Risques & Biais", questions: [
                { q: "John Snow a identifi√© la source du Chol√©ra en :", o: ["Analysant l'air", "Cartographiant les cas", "Utilisant un microscope"], a: 1, e: "Il a fait de l'√©pid√©miologie spatiale √† Londres." },
                { q: "Un ratio (ex: Sex-ratio) se d√©finit par :", o: ["Num√©rateur inclus dans d√©nominateur", "Num√©rateur et d√©nominateur distincts"], a: 1, e: "Ex: 10 Hommes / 5 Femmes." },
                { q: "La mortalit√© mesure les d√©c√®s rapport√©s √† :", o: ["La population totale", "Le nombre de malades"], a: 0, e: "Rapport√© aux malades, c'est la l√©talit√©." },
                { q: "Une √©tude transversale permet d'estimer :", o: ["L'incidence", "La pr√©valence", "Le RR"], a: 1, e: "C'est une 'photo' √† un instant T." },
                { q: "L'Odds Ratio (OR) est proche du RR si :", o: ["La maladie est fr√©quente", "La maladie est rare"], a: 1, e: "Condition d'approximation pour les maladies rares." },
                { q: "Un OR = 2.5 avec IC95% [0.8 ; 4.2] est :", o: ["Significatif", "Non significatif"], a: 1, e: "L'intervalle contient 1, on ne peut pas rejeter H0." },
                { q: "Le biais de m√©morisation touche surtout les √©tudes :", o: ["Prospectives", "R√©trospectives (Cas-T√©moins)"], a: 1, e: "Les gens oublient leurs expositions pass√©es." },
                { q: "La randomisation sert √† :", o: ["Augmenter l'√©chantillon", "√âquilibrer les facteurs de confusion"], a: 1, e: "Elle rend les groupes comparables au d√©part." },
                { q: "L'incidence est une mesure de :", o: ["Stock", "Flux"], a: 1, e: "C'est la vitesse d'apparition de nouveaux cas." },
                { q: "L'√©pid√©miologie descriptive r√©pond √† :", o: ["Pourquoi ?", "Qui, o√π, quand ?"], a: 1, e: "Elle d√©crit sans chercher la causalit√©." }
            ]}
        };

        let currentModule = '';
        let currentIdx = 0;
        let score = 0;
        let userErrors = [];
        let scoresSaved = JSON.parse(localStorage.getItem('stats_ue27_v2')) || {};

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id + (id.includes('section') ? '' : '')).classList.remove('hidden');
            if(id === 'home') renderModules();
            if(id === 'stats') renderStats();
        }

        function renderModules() {
            const grid = document.getElementById('module-grid');
            grid.innerHTML = '';
            Object.keys(db).forEach(key => {
                const s = scoresSaved[key] || 0;
                grid.innerHTML += `
                    <div onclick="startQuiz('${key}')" class="bg-white p-6 rounded-3xl shadow-md border-b-8 ${s > 70 ? 'border-green-400' : 'border-indigo-400'} cursor-pointer card-hover transition">
                        <h3 class="font-bold text-lg mb-1">${db[key].title}</h3>
                        <p class="text-gray-500 text-xs mb-4">10 Questions</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-black px-2 py-1 rounded bg-slate-100">${s}% r√©ussi</span>
                            <span class="text-indigo-600 font-bold text-sm">Lancer ‚Üí</span>
                        </div>
                    </div>`;
            });
        }

        function startQuiz(key) {
            currentModule = key;
            currentIdx = 0;
            score = 0;
            userErrors = [];
            showSection('quiz-section');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('review-content').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = db[currentModule].questions[currentIdx];
            document.getElementById('quiz-title').innerText = db[currentModule].title;
            document.getElementById('progress-text').innerText = `${currentIdx + 1} / 10`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:bg-slate-50 font-medium transition";
                b.innerText = opt;
                b.onclick = () => check(i, b);
                container.appendChild(b);
            });
        }

        function check(idx, btn) {
            const q = db[currentModule].questions[currentIdx];
            const btns = document.getElementById('options-container').children;
            const isCorrect = (idx === q.a);
            
            if(isCorrect) {
                score++;
                btn.classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Bravo !";
                document.getElementById('feedback-status').className = "text-green-600 font-bold";
            } else {
                btn.classList.add('wrong-btn');
                btns[q.a].classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Erreur...";
                document.getElementById('feedback-status').className = "text-red-600 font-bold";
                userErrors.push({ q: q.q, correct: q.o[q.a], expl: q.e });
            }

            document.getElementById('explanation-text').innerText = q.e;
            document.getElementById('explanation-box').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            for(let b of btns) b.disabled = true;
  
