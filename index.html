<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatsMaster Pro - UE27 Pr. Balay√©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct-btn { background-color: #10b981 !important; color: white; border-color: #059669 !important; }
        .wrong-btn { background-color: #ef4444 !important; color: white; border-color: #b91c1c !important; }
        .hidden { display: none; }
        .card-hover:hover { transform: translateY(-5px); transition: 0.3s; }
        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

    <nav class="bg-indigo-900 text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">üìä UE27 <span class="text-indigo-300 font-light">Stats</span></h1>
            <div class="flex gap-6 font-medium">
                <button onclick="showSection('home')" class="hover:text-indigo-300 transition">Entra√Ænement</button>
                <button onclick="showSection('stats')" class="hover:text-indigo-300 transition">Ma Progression</button>
            </div>
        </div>
    </nav>

    <section id="home" class="container mx-auto p-6">
        <header class="text-center mb-10">
            <h2 class="text-3xl font-extrabold text-slate-800">Pr√™t pour les partiels ?</h2>
            <p class="text-slate-500 mt-2">Choisis un module pour tester tes connaissances (15 questions par chapitre)</p>
        </header>
        <div class="grid md:grid-cols-3 gap-8" id="module-grid"></div>
    </section>

    <section id="stats-section" class="container mx-auto p-6 hidden">
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-[2rem] shadow-2xl border border-slate-100">
            <h2 class="text-3xl font-black text-center mb-10 text-slate-800">Taux de Compr√©hension</h2>
            
            <div class="flex flex-col md:flex-row items-center justify-around gap-10 mb-12">
                <div class="relative flex items-center justify-center">
                    <svg class="w-40 h-40">
                        <circle class="text-slate-100" stroke-width="12" stroke="currentColor" fill="transparent" r="70" cx="80" cy="80"/>
                        <circle id="score-circle" class="text-indigo-600 progress-ring" stroke-width="12" stroke-dasharray="440" stroke-dashoffset="440" stroke-linecap="round" stroke="currentColor" fill="transparent" r="70" cx="80" cy="80"/>
                    </svg>
                    <span id="global-score-text" class="absolute text-3xl font-black text-slate-800">0%</span>
                </div>
                <div class="flex-1 space-y-4 w-full" id="module-stats-details">
                    </div>
            </div>

            <div class="bg-indigo-50 p-6 rounded-2xl">
                <h4 class="font-bold text-indigo-900 mb-2">Conseil de r√©vision üí°</h4>
                <p class="text-indigo-800 text-sm leading-relaxed" id="conseil-text">Compl√®te tous les modules pour voir ton analyse de niveau.</p>
            </div>
            
            <button onclick="resetData()" class="block mx-auto mt-10 text-slate-400 hover:text-red-500 text-sm underline transition">R√©initialiser mes scores</button>
        </div>
    </section>

    <section id="quiz-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-[2rem] shadow-2xl">
            <div id="quiz-header" class="flex justify-between items-center mb-8 border-b pb-4">
                <span id="quiz-title" class="font-black text-indigo-600 uppercase tracking-tighter text-sm"></span>
                <span id="progress-text" class="bg-slate-100 px-3 py-1 rounded-full text-xs font-bold text-slate-500"></span>
            </div>

            <div id="quiz-content">
                <h2 id="question-text" class="text-xl font-bold text-slate-800 mb-8 leading-snug"></h2>
                <div id="options-container" class="space-y-4"></div>
                
                <div id="explanation-box" class="mt-8 p-5 rounded-2xl bg-slate-50 border-2 border-slate-100 hidden animate-pulse-once">
                    <div class="flex items-start gap-3">
                        <span id="feedback-icon" class="text-2xl"></span>
                        <div>
                            <p id="feedback-status" class="font-bold mb-1"></p>
                            <p id="explanation-text" class="text-sm text-slate-600 italic"></p>
                        </div>
                    </div>
                </div>

                <button id="next-btn" class="w-full mt-8 bg-slate-900 text-white py-4 rounded-2xl font-black shadow-xl hidden transform active:scale-95 transition">QUESTION SUIVANTE</button>
            </div>

            <div id="review-content" class="hidden text-center">
                <div class="mb-8">
                    <h3 class="text-4xl font-black text-slate-800 mb-2">Quiz Termin√© !</h3>
                    <p class="text-slate-500">Voici l'analyse de tes erreurs pour t'aider √† progresser.</p>
                </div>
                <div id="errors-list" class="text-left space-y-4 mb-10 max-h-96 overflow-y-auto pr-2"></div>
                <button onclick="showSection('home')" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-lg">RETOUR AU MENU</button>
            </div>
        </div>
    </section>

    <script>
        // BASE DE DONN√âES - 45 QUESTIONS (15 par chapitre)
        const db = {
            c1: { title: "Introduction Statistique", questions: [
                { q: "Laquelle de ces d√©finitions correspond √† la Statistique ?", o: ["Science du recueil, analyse et interpr√©tation", "S√©rie de r√©sultats chiffr√©s", "Calcul de probabilit√©s uniquement"], a: 0, e: "La statistique est la science. Les statistiques sont les donn√©es." },
                { q: "Une variable 'Poids' est :", o: ["Qualitative", "Quantitative discr√®te", "Quantitative continue"], a: 2, e: "C'est une variable num√©rique pouvant prendre n'importe quelle valeur r√©elle." },
                { q: "Si p = 0.02, que conclut-on au risque alpha 5% ?", o: ["On conserve H0", "On rejette H0 : Significatif", "Erreur de mesure"], a: 1, e: "p < 0.05 signifie que le r√©sultat n'est pas d√ª au hasard." },
                { q: "La statistique descriptive sert √† :", o: ["Extrapoler", "R√©sumer les donn√©es", "Calculer le risque de base"], a: 1, e: "Elle pr√©sente l'information de mani√®re pertinente (moyenne, graphiques)." },
                { q: "Le mode est :", o: ["La valeur centrale", "La valeur la plus fr√©quente", "La moyenne"], a: 1, e: "C'est la valeur associ√©e au plus grand effectif." },
                { q: "L'√©cart-type est un indicateur de :", o: ["Position", "Dispersion", "Liaison"], a: 1, e: "Il montre comment les valeurs sont √©tal√©es autour de la moyenne." },
                { q: "Le test de corr√©lation r √©tudie :", o: ["La diff√©rence de moyennes", "Le lien entre 2 variables quantitatives", "La pr√©cision d'un test"], a: 1, e: "Il mesure la force du lien lin√©aire entre deux variables num√©riques." },
                { q: "Un test non-significatif prouve l'absence d'effet.", o: ["Vrai", "Faux"], a: 1, e: "Non ! Il signifie juste qu'on n'a pas pu prouver d'effet avec cet √©chantillon." },
                { q: "Une variable 'Sexe' est :", o: ["Qualitative nominale", "Qualitative ordinale", "Quantitative"], a: 0, e: "Nominale car il n'y a pas d'ordre entre les cat√©gories." },
                { q: "L'inf√©rence statistique extrapole les donn√©es :", o: ["De l'√©chantillon vers la population", "De la population vers l'√©chantillon"], a: 0, e: "C'est le but de la statistique inf√©rentielle." },
                { q: "H0 signifie :", o: ["Absence de diff√©rence", "Pr√©sence d'un effet", "Erreur fatale"], a: 0, e: "Hypoth√®se nulle = tout est d√ª au hasard." },
                { q: "La variance est :", o: ["L'√©cart-type au carr√©", "La racine de l'√©cart-type"], a: 0, e: "s¬≤ = variance." },
                { q: "Un √©chantillon doit √™tre :", o: ["Petit", "Repr√©sentatif", "B√©n√©vole"], a: 1, e: "La repr√©sentativit√© permet la g√©n√©ralisation." },
                { q: "r = -0.7 indique une corr√©lation :", o: ["Faible", "Forte et inverse", "Positive"], a: 1, e: "Plus r est proche de -1 ou 1, plus le lien est fort." },
                { q: "La d√©marche statistique comprend :", o: ["Le recueil PUIS l'analyse", "L'analyse PUIS le recueil"], a: 0, e: "On r√©colte d'abord, on traite apr√®s." }
            ]},
            c2: { title: "Test Diagnostique", questions: [
                { q: "La Sensibilit√© est :", o: ["P(T+|M+)", "P(M+|T+)", "P(T-|M-)"], a: 0, e: "Capacit√© √† d√©tecter les vrais malades (VP / VP+FN)." },
                { q: "La Sp√©cificit√© est :", o: ["Capacit√© √† identifier les sains", "Capacit√© √† identifier les malades"], a: 0, e: "P(T-|M-). Capacit√© √† ne pas donner de faux positifs." },
                { q: "La VPP d√©pend de :", o: ["Seulement du test", "De la pr√©valence", "De l'√¢ge du patient"], a: 1, e: "Plus la maladie est rare, plus la VPP est faible." },
                { q: "Le Kappa de Cohen mesure :", o: ["Le risque", "La concordance", "L'incidence"], a: 1, e: "Il compare l'accord r√©el √† l'accord d√ª au hasard." },
                { q: "Un Kappa de 0.25 est :", o: ["Excellent", "Faible", "Mod√©r√©"], a: 1, e: "Entre 0.2 et 0.4, la concordance est faible." },
                { q: "L'aire sous la courbe ROC (AUC) parfaite est :", o: ["0.5", "1", "0"], a: 1, e: "1 signifie une discrimination parfaite entre sains et malades." },
                { q: "Le Gold Standard est :", o: ["Le test √† √©valuer", "La r√©f√©rence absolue", "Le test le moins cher"], a: 1, e: "C'est l'examen de v√©rit√© (ex: biopsie)." },
                { q: "Si Se=100%, il n'y a aucun :", o: ["Faux N√©gatif", "Faux Positif"], a: 0, e: "S'il est 100% sensible, il ne rate aucun malade." },
                { q: "La courbe ROC lie :", o: ["Se et (1-Sp)", "VPP et VPN", "Se et Sp"], a: 0, e: "Elle permet de choisir le meilleur seuil." },
                { q: "Le Kappa prend en compte :", o: ["Le hasard", "La moyenne", "Le poids"], a: 0, e: "C'est sa force par rapport au simple % d'accord." },
                { q: "VPP signifie :", o: ["Valeur pr√©dictive positive", "Vitesse de progression"], a: 0, e: "Probabilit√© d'√™tre malade si le test est positif." },
                { q: "Pour un d√©pistage massif, on veut une :", o: ["Haute Sensibilit√©", "Haute Sp√©cificit√©"], a: 0, e: "On veut ratisser large et ne rater personne." },
                { q: "La pr√©valence est la proportion de malades :", o: ["√Ä un instant T", "Apparus dans l'ann√©e"], a: 0, e: "C'est une photo de la population." },
                { q: "Si on augmente le seuil d'un test, la sp√©cificit√© :", o: ["Augmente", "Diminue"], a: 0, e: "Plus on est s√©v√®re, moins on a de faux positifs." },
                { q: "Validit√© intrins√®que regroupe :", o: ["Se et Sp", "VPP et VPN"], a: 0, e: "Elles ne changent pas selon la population test√©e." }
            ]},
            c3: { title: "√âpid√©miologie", questions: [
                { q: "L'incidence est :", o: ["Le nombre de cas totaux", "Le flux de nouveaux cas"], a: 1, e: "C'est une notion de vitesse d'apparition." },
                { q: "Le Risque Relatif (RR) se calcule en :", o: ["Cohorte", "Cas-T√©moin", "Transversale"], a: 0, e: "On suit l'exposition pour voir le risque futur." },
                { q: "L'Odds Ratio (OR) est utilis√© en :", o: ["Cohorte", "Cas-T√©moin"], a: 1, e: "On part des malades pour chercher l'exposition pass√©e." },
                { q: "RR = 1 signifie :", o: ["Risque √©lev√©", "Pas d'association", "Protection"], a: 1, e: "Autant de risque chez les expos√©s que les non-expos√©s." },
                { q: "Si IC 95% du RR est [1.2 ; 2.5] :", o: ["C'est significatif", "Ce n'est pas significatif"], a: 0, e: "L'intervalle ne contient pas 1, le risque est r√©el." },
                { q: "L'√©tude transversale donne la :", o: ["Pr√©valence", "Incidence"], a: 0, e: "C'est une mesure √† un instant pr√©cis." },
                { q: "Un facteur protecteur a un RR :", o: ["> 1", "< 1"], a: 1, e: "L'exposition diminue le risque de maladie." },
                { q: "Le biais de confusion se g√®re par :", o: ["La randomisation", "L'augmentation de l'effectif"], a: 0, e: "Le tirage au sort √©quilibre les facteurs tiers." },
                { q: "L'√©pid√©miologie descriptive r√©pond √† :", o: ["Pourquoi ?", "Qui, O√π, Quand ?", "Comment traiter ?"], a: 1, e: "Elle observe la distribution sans chercher la cause." },
                { q: "Une √©tude de cohorte est :", o: ["Prospective", "R√©trospective"], a: 0, e: "On suit les sujets dans le temps." },
                { q: "L'OR de 0.6 signifie :", o: ["Protection de 40%", "Risque augment√© de 60%"], a: 0, e: "Inf√©rieur √† 1 = protection." },
                { q: "L'√©tude Cas-T√©moin est id√©ale pour :", o: ["Maladies fr√©quentes", "Maladies rares"], a: 1, e: "Plus rapide et moins cher pour les cas rares." },
                { q: "Taux de mortalit√© = ", o: ["Morts / Population", "Morts / Malades"], a: 0, e: "√Ä diff√©rencier de la l√©talit√©." },
                { q: "Q17 Balay√© : OR = 1.10 IC95% [1.05 ; 1.18] est :", o: ["Significatif", "Non significatif"], a: 0, e: "Car 1 n'est pas dans l'intervalle." },
                { q: "La p-valeur (Q18 Balay√©) est :", o: ["La probabilit√© d'observer les donn√©es sous H0", "La certitude du test"], a: 0, e: "Force de preuve contre l'hypoth√®se nulle." }
            ]}
        };

        // GESTION D'√âTAT
        let scores = JSON.parse(localStorage.getItem('stats_pro_v5')) || { c1: 0, c2: 0, c3: 0 };
        let currentModule = '';
        let currentIdx = 0;
        let scoreCount = 0;
        let mistakes = [];

        // INITIALISATION
        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id + (id.includes('section') ? '' : '')).classList.remove('hidden');
            if(id === 'home') renderHome();
            if(id === 'stats') renderStats();
        }

        function renderHome() {
            const grid = document.getElementById('module-grid');
            grid.innerHTML = '';
            Object.keys(db).forEach(k => {
                const s = scores[k];
                grid.innerHTML += `
                    <div onclick="startQuiz('${k}')" class="bg-white p-8 rounded-[2rem] shadow-lg border-b-8 ${s > 70 ? 'border-green-400' : 'border-indigo-500'} cursor-pointer card-hover transition">
                        <h3 class="font-black text-xl text-slate-800 mb-2">${db[k].title}</h3>
                        <div class="flex justify-between items-center mt-6">
                            <span class="text-xs font-bold px-3 py-1 bg-slate-100 rounded-full">${s}% r√©ussi</span>
                            <span class="text-indigo-600 font-black text-sm uppercase">Lancer ‚Üí</span>
                        </div>
                    </div>`;
            });
        }

        function startQuiz(k) {
            currentModule = k;
            currentIdx = 0;
            scoreCount = 0;
            mistakes = [];
            showSection('quiz-section');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('review-content').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = db[currentModule].questions[currentIdx];
            document.getElementById('quiz-title').innerText = db[currentModule].title;
            document.getElementById('progress-text').innerText = `${currentIdx + 1} / 15`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-5 rounded-2xl border-2 border-slate-100 hover:bg-indigo-50 font-bold transition flex items-center justify-between";
                b.innerHTML = `<span>${opt}</span><span class="opacity-0">‚úî</span>`;
                b.onclick = () => check(i, b);
                container.appendChild(b);
            });
        }

        function check(idx, b) {
            const q = db[currentModule].questions[currentIdx];
            const btns = document.getElementById('options-container').children;
            const correct = idx === q.a;

            if(correct) {
                scoreCount++;
                b.classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "EXCELLENT !";
                document.getElementById('feedback-status').className = "font-black text-green-600";
                document.getElementById('feedback-icon').innerText = "‚úÖ";
            } else {
                b.classList.add('wrong-btn');
                btns[q.a].classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "ERREUR";
                document.getElementById('feedback-status').className = "font-black text-red-600";
                document.getElementById('feedback-icon').innerText = "‚ùå";
                mistakes.push({ q: q.q, correct: q.o[q.a], e: q.e });
            }

            document.getElementById('explanation-text').innerText = q.e;
            document.getElementById('explanation-box').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            for(let btn of btns) btn.disabled = true;
        }

        document.getElementById('next-btn').onclick = () => {
            currentIdx++;
            if(currentIdx < 15) loadQuestion(); else finish();
        };

        function finish() {
            const p = Math.round((scoreCount / 15) * 100);
            if(p > scores[currentModule]) {
                scores[currentModule] = p;
                localStorage.setItem('stats_pro_v5', JSON.stringify(scores));
            }
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('review-content').classList.remove('hidden');
            const errDiv = document.getElementById('errors-list');
            errDiv.innerHTML = mistakes.length ? "" : "<p class='text-green-600 font-bold text-center'>Parfait ! Aucune erreur.</p>";
            mistakes.forEach(m => {
                errDiv.innerHTML += `
                    <div class="p-4 bg-slate-50 rounded-2xl border-l-4 border-red-500">
                        <p class="font-bold text-sm mb-1">${m.q}</p>
                        <p class="text-xs text-green-600 font-bold">R√©ponse : ${m.correct}</p>
                        <p class="text-xs text-slate-500 italic mt-1">${m.e}</p>
                    </div>`;
            });
        }

        // RENDU DE L'ONGLET PROGRESSION
        function renderStats() {
            const avg = Math.round((scores.c1 + scores.c2 + scores.c3) / 3);
            
            // Animation du cercle
            const circle = document.getElementById('score-circle');
            const offset = 440 - (avg / 100) * 440;
            circle.style.strokeDashoffset = offset;
            document.getElementById('global-score-text').innerText = avg + "%";

            // D√©tails par module
            const details = document.getElementById('module-stats-details');
            details.innerHTML = '';
            Object.keys(db).forEach(k => {
           
