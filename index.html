<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StatsMaster Pro - UE27</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct-btn { background-color: #10b981 !important; border-color: #059669 !important; color: white; }
        .wrong-btn { background-color: #ef4444 !important; border-color: #b91c1c !important; color: white; }
        .hidden { display: none; }
        .card-hover:hover { transform: translateY(-5px); transition: 0.3s; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <nav class="bg-indigo-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">üìä UE27 : Stats & √âpido</h1>
            <div class="flex gap-4">
                <button onclick="showSection('home')" class="hover:text-indigo-200">Accueil</button>
                <button onclick="showSection('stats')" class="hover:text-indigo-200">Progression</button>
            </div>
        </div>
    </nav>

    <section id="home" class="container mx-auto p-6">
        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Modules d'Entra√Ænement</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="module-grid"></div>
    </section>

    <section id="stats-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl text-center">
            <h2 class="text-3xl font-bold mb-4">Tableau de Bord</h2>
            <div id="global-score" class="text-6xl font-black text-indigo-600 mb-8">0%</div>
            <div id="module-stats" class="space-y-4 text-left"></div>
            <button onclick="resetScores()" class="mt-12 bg-red-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-red-700 transition">
                R√âINITIALISER TOUS LES SCORES
            </button>
        </div>
    </section>

    <section id="quiz-section" class="container mx-auto p-6 hidden">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <span id="quiz-title" class="text-indigo-600 font-bold uppercase text-xs tracking-widest"></span>
                <span id="progress-text" class="text-gray-400 text-sm"></span>
            </div>
            <div id="quiz-content">
                <h2 id="question-text" class="text-xl font-semibold text-gray-800 mb-6"></h2>
                <div id="options-container" class="space-y-3"></div>
                <div id="explanation-box" class="mt-6 p-4 rounded-xl bg-amber-50 border border-amber-200 hidden">
                    <p class="text-sm text-amber-800"><strong id="feedback-status"></strong> <span id="explanation-text"></span></p>
                </div>
                <button id="next-btn" class="w-full mt-8 bg-indigo-600 text-white py-4 rounded-xl font-bold hidden shadow-lg">Continuer</button>
            </div>
            <div id="review-content" class="hidden">
                <h3 class="text-2xl font-bold mb-4 text-center">Analyse de tes erreurs üßê</h3>
                <div id="errors-list" class="space-y-4 mb-8"></div>
                <button onclick="showSection('home')" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold">Retour √† l'accueil</button>
            </div>
        </div>
    </section>

    <script>
        const db = {
            c1: { title: "Introduction Statistique 1", questions: [
                { q: "La statistique est :", o: ["La science du recueil", "Les chiffres d'une √©tude", "Une probabilit√©"], a: 0, e: "Science vs R√©sultats chiffr√©s." },
                { q: "Variable 'Taille' :", o: ["Qualitative", "Quantitative discr√®te", "Quantitative continue"], a: 2, e: "Mesure continue." },
                { q: "p = 0.04 au seuil 5% :", o: ["Conserve H0", "Rejette H0"], a: 1, e: "Significatif car p < 0.05." },
                { q: "La m√©diane partage la s√©rie en :", o: ["2 parties √©gales", "3 parties", "Le plus fr√©quent"], a: 0, e: "50% au-dessus, 50% en-dessous." },
                { q: "Corr√©lation de Pearson :", o: ["2 quantitatives", "2 moyennes", "Concordance"], a: 0, e: "Lien lin√©aire entre 2 chiffres." },
                { q: "H0 signifie :", o: ["Diff√©rence", "Pas de diff√©rence"], a: 1, e: "Hypoth√®se de base du hasard." },
                { q: "√âcart-type mesure :", o: ["Position", "Dispersion"], a: 1, e: "√âtagement autour de la moyenne." },
                { q: "√âtude de toute la population :", o: ["Sondage", "Recensement"], a: 1, e: "Ex: Recensement INSEE." },
                { q: "Risque Alpha :", o: ["Rejeter H0 √† tort", "Conserver H0 √† tort"], a: 0, e: "Erreur de type I." },
                { q: "Variable ordinale :", o: ["Quantitative", "Qualitative avec ordre"], a: 1, e: "Ex: Stade de maladie I, II, III." }
            ]},
            c2: { title: "Tests Diagnostiques 1", questions: [
                { q: "Probabilit√© T+ chez Malade :", o: ["VPP", "Sensibilit√©", "Sp√©cificit√©"], a: 1, e: "Se = capacit√© √† d√©tecter les malades." },
                { q: "Sp√©cificit√© :", o: ["T- chez non-malades", "M- chez T-"], a: 0, e: "Identifier les sujets sains." },
                { q: "La VPP d√©pend de la pr√©valence :", o: ["Vrai", "Faux"], a: 0, e: "Plus la maladie est rare, plus la VPP baisse." },
                { q: "Kappa √©value :", o: ["Le risque", "La concordance"], a: 1, e: "Accord au-del√† du hasard." },
                { q: "Kappa = 0.85 :", o: ["Moyen", "Excellent"], a: 1, e: "> 0.80 est excellent." },
                { q: "Courbe ROC :", o: ["Se / (1-Sp)", "VPP / VPN"], a: 0, e: "Performance du test." },
                { q: "AUC test parfait :", o: ["0.5", "1"], a: 1, e: "100% de discrimination." },
                { q: "Gold Standard :", o: ["R√©f√©rence de v√©rit√©", "Nouveau test"], a: 0, e: "L'examen de certitude." },
                { q: "Augmenter le seuil :", o: ["Se augmente", "Se diminue"], a: 1, e: "On devient plus strict." },
                { q: "VPN :", o: ["Probabilit√© sain si T-", "Probabilit√© sain si T+"], a: 0, e: "Validit√© en situation r√©elle." }
            ]},
            c3: { title: "√âpid√©miologie 1", questions: [
                { q: "L'incidence :", o: ["Anciens cas", "Nouveaux cas"], a: 1, e: "Vitesse d'apparition." },
                { q: "RR calcul√© dans :", o: ["Cas-T√©moins", "Cohorte"], a: 1, e: "Suivi temporel requis." },
                { q: "OR utilis√© en :", o: ["Cas-T√©moins", "Cohorte"], a: 0, e: "Part de la maladie." },
                { q: "RR = 1 :", o: ["Risque doubl√©", "Pas d'association"], a: 1, e: "Neutre." },
                { q: "IC95% [1.2 ; 3.4] :", o: ["Significatif", "Non-significatif"], a: 0, e: "Exclut la valeur 1." },
                { q: "√âtude transversale :", o: ["Incidence", "Pr√©valence"], a: 1, e: "Photo √† un instant T." },
                { q: "Facteur de risque :", o: ["RR > 1", "RR < 1"], a: 0, e: "Augmente la probabilit√©." },
                { q: "Randomisation limite :", o: ["Biais de confusion", "Erreurs de saisie"], a: 0, e: "√âquilibre les groupes." },
                { q: "√âpido √©tiologique :", o: ["Compter", "Chercher les causes"], a: 1, e: "√âtude des facteurs." },
                { q: "Cohorte est :", o: ["R√©trospective", "Prospective"], a: 1, e: "Vers le futur." }
            ]},
            c4: { title: "Formatage & Recueil (Expert)", questions: [
                { q: "Une ligne Excel = ", o: ["Une variable", "Un individu"], a: 1, e: "Structure standard : Ligne = Sujet." },
                { q: "Format de fichier proscrit :", o: ["CSV", "PDF"], a: 1, e: "PDF inexploitable en stat." },
                { q: "Sexe (H/F) :", o: ["Qualitative binaire", "Quantitative"], a: 0, e: "2 cat√©gories." },
                { q: "Le Codebook sert √† :", o: ["Calculer", "D√©finir les variables"], a: 1, e: "Dictionnaire de donn√©es." },
                { q: "Cellules fusionn√©es :", o: ["Interdites", "Conseill√©es"], a: 0, e: "Casse le traitement de donn√©es." },
                { q: "Stat univari√©e :", o: ["1 variable", "2 variables"], a: 0, e: "Ex: Moyenne d'√¢ge." },
                { q: "Graphique variable qualitative :", o: ["Histogramme", "Circulaire"], a: 1, e: "Pour les proportions." },
                { q: "Mode classe [20-30] :", o: ["25", "30"], a: 0, e: "Centre de la classe." },
                { q: "Tirage al√©atoire :", o: ["Repr√©sentativit√©", "Biais"], a: 0, e: "Garantit l'absence de choix." },
                { q: "Plan d'analyse r√©dig√© :", o: ["Avant recueil", "Apr√®s analyse"], a: 0, e: "Protocole fixe." }
            ]},
            c5: { title: "ROC & Kappa (Expert)", questions: [
                { q: "AUC proche de 1 :", o: ["Performant", "M√©diocre"], a: 0, e: "Bonne s√©paration." },
                { q: "Diagonale ROC :", o: ["Hasard pur", "Test parfait"], a: 0, e: "AUC = 0.5." },
                { q: "Baisser le seuil :", o: ["Augmente Se", "Baisse Se"], a: 0, e: "Plus de malades d√©tect√©s." },
                { q: "Kappa retire :", o: ["Hasard", "Erreurs"], a: 0, e: "Accord al√©atoire exclu." },
                { q: "Kappa = 0.30 :", o: ["Faible", "Excellent"], a: 0, e: "Accord m√©diocre." },
                { q: "Reproductibilit√© :", o: ["Concordance", "Sensibilit√©"], a: 0, e: "M√™me r√©sultat r√©p√©t√©." },
                { q: "Biopsie pour cancer :", o: ["Gold Standard", "Test d√©pistage"], a: 0, e: "La v√©rit√©." },
                { q: "D√©pistage priorit√© :", o: ["Sensibilit√©", "Sp√©cificit√©"], a: 0, e: "Ne rien rater." },
                { q: "VPN augmente si :", o: ["Maladie rare", "Maladie fr√©quente"], a: 0, e: "Plus facile d'exclure." },
                { q: "AUC = 0.8 :", o: ["Bon test", "M√©diocre"], a: 0, e: "Performance correcte." }
            ]},
            c6: { title: "Risques & Biais (Expert)", questions: [
                { q: "John Snow :", o: ["Cartographie", "Miasmes"], a: 0, e: "Chol√©ra Londres 1854." },
                { q: "Ratio :", o: ["Num/D√©num distincts", "Inclus"], a: 0, e: "Ex: H/F." },
                { q: "Mortalit√© :", o: ["Population totale", "Malades"], a: 0, e: "Indicateur global." },
                { q: "√âtude transversale :", o: ["Pr√©valence", "Incidence"], a: 0, e: "Instantan√©." },
                { q: "OR ~ RR si :", o: ["Maladie rare", "Maladie fr√©quente"], a: 0, e: "Hypoth√®se n√©cessaire." },
                { q: "OR = 2.5 [0.8-4.2] :", o: ["Significatif", "Non significatif"], a: 1, e: "1 est dans l'IC." },
                { q: "Biais m√©morisation :", o: ["R√©trospectif", "Prospectif"], a: 0, e: "Cas-t√©moins surtout." },
                { q: "Randomisation :", o: ["√âquilibre confusion", "Gagne temps"], a: 0, e: "Rend comparables." },
                { q: "Incidence :", o: ["Flux", "Stock"], a: 0, e: "Nouveaux cas." },
                { q: "√âpido descriptive :", o: ["Qui, O√π, Quand", "Pourquoi"], a: 0, e: "Description simple." }
            ]}
        };

        let currentModule = '';
        let currentIdx = 0;
        let score = 0;
        let userErrors = [];
        let scoresSaved = JSON.parse(localStorage.getItem('stats_final_v2')) || {};

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id + (id.includes('section') ? '' : '')).classList.remove('hidden');
            if(id === 'home') renderModules();
            if(id === 'stats') renderStats();
        }

        function renderModules() {
            const grid = document.getElementById('module-grid');
            grid.innerHTML = '';
            Object.keys(db).forEach(key => {
                const s = scoresSaved[key] || 0;
                grid.innerHTML += `
                    <div onclick="startQuiz('${key}')" class="bg-white p-6 rounded-3xl shadow-md border-b-8 ${s > 70 ? 'border-green-400' : 'border-indigo-400'} cursor-pointer card-hover transition">
                        <h3 class="font-bold text-lg mb-1">${db[key].title}</h3>
                        <p class="text-gray-500 text-xs mb-4">10 Questions</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-black px-2 py-1 rounded bg-slate-100">${s}% r√©ussi</span>
                            <span class="text-indigo-600 font-bold text-sm">Lancer ‚Üí</span>
                        </div>
                    </div>`;
            });
        }

        function startQuiz(key) {
            currentModule = key; currentIdx = 0; score = 0; userErrors = [];
            showSection('quiz-section');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('review-content').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const q = db[currentModule].questions[currentIdx];
            document.getElementById('quiz-title').innerText = db[currentModule].title;
            document.getElementById('progress-text').innerText = `${currentIdx + 1} / 10`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('explanation-box').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:bg-slate-50 font-medium transition";
                b.innerText = opt;
                b.onclick = () => check(i, b);
                container.appendChild(b);
            });
        }

        function check(idx, btn) {
            const q = db[currentModule].questions[currentIdx];
            const btns = document.getElementById('options-container').children;
            const isCorrect = (idx === q.a);
            if(isCorrect) {
                score++; btn.classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Bravo !";
                document.getElementById('feedback-status').className = "text-green-600 font-bold";
            } else {
                btn.classList.add('wrong-btn'); btns[q.a].classList.add('correct-btn');
                document.getElementById('feedback-status').innerText = "Erreur...";
                document.getElementById('feedback-status').className = "text-red-600 font-bold";
                userErrors.push({ q: q.q, correct: q.o[q.a], expl: q.e });
            }
            document.getElementById('explanation-text').innerText = q.e;
            document.getElementById('explanation-box').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            for(let b of btns) b.disabled = true;
        }

        document.getElementById('next-btn').onclick = () => {
            currentIdx++; if(currentIdx < 10) loadQuestion(); else finish();
        };

        function finish() {
            const p = Math.round((score / 10) * 100);
            if(p > (scoresSaved[currentModule] || 0)) {
                scoresSaved[currentModule] = p;
                localStorage.setItem('stats_final_v2', JSON.stringify(scoresSaved));
            }
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('review-content').classList.remove('hidden');
            const errList = document.getElementById('errors-list');
            errList.innerHTML = userErrors.length === 0 ? "<p class='text-green-600 font-bold text-center'>Parfait !</p>" : "";
            userErrors.forEach(err => {
                errList.innerHTML += `<div class="p-4 bg-red-50 rounded-xl border-l-4 border-red-400"><p class="font-bold text-gray-800 text-sm">${err.q}</p><p class="text-xs text-green-700 font-bold mt-1">‚úì Correct : ${err.correct}</p></div>`;
            });
        }

        function renderStats() {
            const keys = Object.keys(db);
            const total = keys.reduce((acc, k) => acc + (scoresSaved[k] || 0), 0);
            const avg = Math.round(total / keys.length);
            document.getElementById('global-score').innerText = avg + "%";
            const cont = document.getElementById('module-stats');
            cont.innerHTML = '';
            keys.forEach(k => {
                cont.innerHTML += `<div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg"><span class="text-sm font-medium">${db[k].title}</span><span class="font-bold text-indigo-600">${scoresSaved[k] || 0}%</span></div>`;
            });
        }

        function resetScores() {
            if(confirm("Effacer tout ?")) {
                localStorage.removeItem('stats_final_v2');
                scoresSaved = {}; renderStats(); renderModules();
            }
        }
        showSection('home');
    </script>
</body>
</html>
