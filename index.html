<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UE27 - StatsMaster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct { background-color: #10b981 !important; color: white; }
        .wrong { background-color: #ef4444 !important; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-indigo-700 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between">
            <span class="font-bold">ðŸ“Š UE27 : STATS & EPIDO</span>
            <div class="space-x-4">
                <button onclick="showSection('home')">Modules</button>
                <button onclick="showSection('stats')">Scores</button>
            </div>
        </div>
    </nav>

    <section id="home" class="container mx-auto p-4">
        <div id="module-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <section id="stats" class="container mx-auto p-4 hidden">
        <div class="bg-white p-6 rounded-xl shadow text-center max-w-md mx-auto">
            <h2 class="text-2xl font-bold mb-4">Progression Totale</h2>
            <div id="global-avg" class="text-5xl font-bold text-indigo-600 mb-6">0%</div>
            <div id="detail-stats" class="text-left space-y-2"></div>
            <button onclick="resetAll()" class="mt-8 bg-red-600 text-white px-4 py-2 rounded">RÃ©initialiser tout</button>
        </div>
    </section>

    <section id="quiz" class="container mx-auto p-4 hidden">
        <div class="bg-white p-6 rounded-xl shadow-lg max-w-2xl mx-auto">
            <h3 id="q-title" class="text-indigo-600 font-bold mb-2"></h3>
            <p id="q-text" class="text-lg mb-6"></p>
            <div id="options" class="space-y-2"></div>
            <div id="feedback" class="mt-4 p-4 rounded bg-gray-50 hidden text-sm"></div>
            <button id="next-btn" class="w-full mt-6 bg-indigo-600 text-white py-3 rounded hidden">Question suivante</button>
        </div>
    </section>

    <script>
        const data = {
            m1: { t: "Intro Statistique 1", qs: [
                { q: "La statistique est :", o: ["La science du recueil", "Un chiffre seul"], a: 0, e: "C'est la science globale selon le Pr BalayÃ©." },
                { q: "Une taille en cm est :", o: ["DiscrÃ¨te", "Continue"], a: 1, e: "Mesure physique = continue." },
                { q: "Si p < 0.05 :", o: ["On rejette H0", "On garde H0"], a: 0, e: "Le rÃ©sultat est significatif." },
                { q: "La mÃ©diane :", o: ["Divise en deux", "Est la plus frÃ©quente"], a: 0, e: "50% au dessus, 50% en dessous." },
                { q: "H0 signifie :", o: ["Il y a un effet", "Pas de diffÃ©rence"], a: 1, e: "C'est l'hypothÃ¨se nulle." }
            ]},
            m2: { t: "Diagnostic 1", qs: [
                { q: "SensibilitÃ© :", o: ["T+ chez Malades", "T- chez sains"], a: 0, e: "CapacitÃ© Ã  dÃ©tecter la maladie." },
                { q: "SpÃ©cificitÃ© :", o: ["T- chez sains", "Sains chez T-"], a: 0, e: "CapacitÃ© Ã  exclure les non-malades." },
                { q: "VPP dÃ©pend de la prÃ©valence :", o: ["Vrai", "Faux"], a: 0, e: "Plus la maladie est rare, plus la VPP est basse." },
                { q: "Kappa :", o: ["Liaison", "Concordance"], a: 1, e: "Accord au-delÃ  du hasard." },
                { q: "AUC parfaite :", o: ["0.5", "1"], a: 1, e: "1 = discrimination totale." }
            ]},
            m3: { t: "Ã‰pidÃ©miologie 1", qs: [
                { q: "Incidence :", o: ["Nouveaux cas", "Anciens cas"], a: 0, e: "Mesure du flux." },
                { q: "RR en cohorte :", o: ["Vrai", "Faux"], a: 0, e: "NÃ©cessite de suivre les sujets." },
                { q: "OR = 1 :", o: ["Protection", "Pas d'association"], a: 1, e: "Valeur neutre." },
                { q: "Transversale :", o: ["PrÃ©valence", "Incidence"], a: 0, e: "C'est une photo Ã  un instant T." },
                { q: "Biais de confusion :", o: ["Facteur tiers", "Erreur de calcul"], a: 0, e: "Brouille la relation rÃ©elle." }
            ]},
            m4: { t: "Recueil (Expert)", qs: [
                { q: "Une ligne Excel :", o: ["Un individu", "Une variable"], a: 0, e: "Une ligne = Un patient." },
                { q: "Format PDF :", o: ["AutorisÃ©", "Interdit"], a: 1, e: "Inexploitable pour les calculs." },
                { q: "Cellule fusionnÃ©e :", o: ["C'est mal", "C'est bien"], a: 0, e: "Interdit en base de donnÃ©es." },
                { q: "Codebook :", o: ["Dictionnaire", "Livre de cours"], a: 0, e: "DÃ©finit le sens des colonnes." },
                { q: "Variable Sexe :", o: ["Nominale", "Ordinale"], a: 0, e: "Pas d'ordre entre H et F." }
            ]},
            m5: { t: "Diagnostic (Expert)", qs: [
                { q: "ROC Diagonale :", o: ["Hasard", "Parfait"], a: 0, e: "AUC = 0.5." },
                { q: "Baisser le seuil :", o: ["Hausse Se", "Baisse Se"], a: 0, e: "On dÃ©tecte plus de gens." },
                { q: "Kappa 0.30 :", o: ["Faible", "Fort"], a: 0, e: "Accord mÃ©diocre." },
                { q: "Gold Standard :", o: ["La vÃ©ritÃ©", "Un test rapide"], a: 0, e: "RÃ©fÃ©rence absolue." },
                { q: "ReproductibilitÃ© :", o: ["Kappa", "p-valeur"], a: 0, e: "Concordance intra-observateur." }
            ]},
            m6: { t: "Ã‰pidÃ©mio (Expert)", qs: [
                { q: "John Snow :", o: ["Cartographie", "Vaccin"], a: 0, e: "PÃ¨re de l'Ã©pido moderne." },
                { q: "Ratio H/F :", o: ["Distincts", "Inclus"], a: 0, e: "NumÃ©rateur n'est pas dans le dÃ©num." },
                { q: "LÃ©talitÃ© :", o: ["Morts / Malades", "Morts / Total"], a: 0, e: "SÃ©vÃ©ritÃ© de la maladie." },
                { q: "OR ~ RR si :", o: ["Maladie rare", "Maladie frÃ©quente"], a: 0, e: "HypothÃ¨se de base." },
                { q: "Randomisation :", o: ["Ã‰quilibre", "Vitesse"], a: 0, e: "GÃ¨re les facteurs inconnus." }
            ] }
        };

        let currentM = ''; let currentQ = 0; let score = 0;
        let scores = JSON.parse(localStorage.getItem('ue27_scores_v3')) || {};

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'home') renderHome();
            if(id === 'stats') renderStats();
        }

        function renderHome() {
            const g = document.getElementById('module-grid');
            g.innerHTML = '';
            Object.keys(data).forEach(k => {
                const s = scores[k] || 0;
                g.innerHTML += `<div onclick="startQuiz('${k}')" class="bg-white p-4 rounded-xl shadow cursor-pointer hover:bg-indigo-50 border-l-4 border-indigo-500">
                    <h4 class="font-bold">${data[k].t}</h4>
                    <p class="text-sm">Score : ${s}%</p>
                </div>`;
            });
        }

        function startQuiz(k) {
            currentM = k; currentQ = 0; score = 0;
            showSection('quiz');
            loadQ();
        }

        function loadQ() {
            const q = data[currentM].qs[currentQ];
            document.getElementById('q-title').innerText = data[currentM].t;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            const o = document.getElementById('options');
            o.innerHTML = '';
            q.o.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left p-3 border rounded hover:bg-gray-50";
                b.innerText = opt;
                b.onclick = () => check(i, b);
                o.appendChild(b);
            });
        }

        function check(i, b) {
            const q = data[currentM].qs[currentQ];
            const opts = document.getElementById('options').children;
            if(i === q.a) { score++; b.classList.add('correct'); }
            else { b.classList.add('wrong'); opts[q.a].classList.add('correct'); }
            document.getElementById('feedback').innerText = q.e;
            document.getElementById('feedback').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            for(let btn of opts) btn.disabled = true;
        }

        document.getElementById('next-btn').onclick = () => {
            currentQ++;
            if(currentQ < data[currentM].qs.length) loadQ();
            else {
                const p = Math.round((score / data[currentM].qs.length) * 100);
                if(p > (scores[currentM] || 0)) { scores[currentM] = p; localStorage.setItem('ue27_scores_v3', JSON.stringify(scores)); }
                showSection('home');
            }
        };

        function renderStats() {
            const ks = Object.keys(data);
            const total = ks.reduce((a, k) => a + (scores[k] || 0), 0);
            document.getElementById('global-avg').innerText = Math.round(total / ks.length) + "%";
            const det = document.getElementById('detail-stats');
            det.innerHTML = '';
            ks.forEach(k => {
                det.innerHTML += `<div class="flex justify-between border-b py-1"><span>${data[k].t}</span><span class="font-bold">${scores[k] || 0}%</span></div>`;
            });
        }

        function resetAll() {
            if(confirm("Tout effacer ?")) { localStorage.clear(); scores = {}; renderStats(); renderHome(); }
        }

        showSection('home');
    </script>
</body>
</html>
